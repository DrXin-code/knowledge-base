#### 简答题

1.CSMA/CD工作过程简述？

2NAT过程？

3.分组交换和电路交换优缺点？

4.协议以及协议栈

5..为什么在因特网中用到了不同的 AS 间与 AS 内部协议？ 答：①策略——在多个 AS 之间，策略问题占主导地位。 很重要的是，来自指定 AS 的流量不 能通过另一个指定 AS。 同样，指定的 AS 可能希望控制它在其他多个 AS 之间携带的过境交 通。 在 AS 内部，所有的东西名义上都在相同的管理控制下，因此策略在选择 AS 中的路由方 面的作用要小得多。 ②规模——路由算法及其数据结构对处理大量网络的路由的能力是 AS 间 路由的一个关键问题。 在 AS 内部，可伸缩性不那么受关注。 首先，如果单个管理域变得太 大，则始终可以将其划分为两个 AS 并在两个新的 AS 之间执行 AS 间路由。 ③性能——由于 AS 间路由是以策略为导向的，因此所使用的路由的质量(例如性能)往往是次要的问题(即满足某 些策略标准的较长或更昂贵的路由很可能被接管到较短但不符合该标准的路由上)。 事实上， 我们看到，在 AS 之间，甚至没有与路线相关的成本概念(除了 AS 跳数)。然而，在单个 AS 中， 这种策略关注的重要性较低，允许路由更多地关注在路由上实现的性能水平。



# 记住

1.第一章公示

2.端口号

3.样本时间公式

4.两个算法比较

# 第一章 概述

1. 延迟组件包括处理延迟（提取首部）、传输延迟（L/R 路由器的分组发送、封装成帧）、传播延迟（距离/时间）、排队延迟。除了排队延迟是变量，其他的都是固定的。

   **链路传输速率**：是指主机或路由器向链路上发送数据的速度，也称为数据率或比特，单位是比特每秒，b/s

   所以当t=传输时间的时候，分组的第一个比特刚好离开主机

   **链路传播速率**：是指电磁波在信道中传播的速度，单位是m/s。该速率取决于链路的物理媒体（如光纤、铜线等，其速率范围为2*10^8m/s 至3*10^8m/s。

   

2. ```python
   //MB/s和Mb/s是有区别的。其中大B代表Byte(字节)，小b代表bit(比特 或位)。
   1 MB = 8 * 1 Mb
   1 Byte = 8 * 1 bit
   
   1 Kb = 1024 bit
   1 KB = 1024 Byte 
   1 Mb = 1024 Kb
   1 MB = 1024 KB
   1 Byte = 8 bit
   1 MB = 8Mb
   1 Mb = 0.125 MB
   
   ```

3. 流量强度=La/R（最大发送速率/最大传输速率），a为分组到达队列的平均速率（分组/s），L为每组的比特量，R为传输速率

   

4. 四个封装应用层报文；传输层段;网络层数据段;链路层帧;

   

5. 路由器处理网络、链路、物理层（第1到3层）、链路层交换机处理链路层和网络层（第1到2层）、主机处理所有的五层。



​	6：【重要】p个分组通过由N条速率均为R的链路组成的路径(N-1个路由器)，ptp时延为
$$
N∗(L/R)+(P−1)∗(L/R)=(N+P−1)∗(L/R)
$$
​	7：分组交换计算使用概率是用二项分布

​     8：最大吞吐量=min{Rs,Rc,R/M}

​	9.协议栈综述

​	（1）应用层

​				协议：HTTP\SMTP\FTP\DNS(运行在UDP上)

​				分布：端系统

​				信息：报文

​	  （2）运输层

​				协议：TCP\UDP

​				信息：报文段

​	（3）网络层

​				协议：IP

​				信息：数据报

​		(4)链路层

​				协议：

​				信息：帧

10.

-  p2p（与c\s一类）

  ​	点对点即Peer-To-Peer，通常简写为P2P。所谓网络中的点对点，其实可以看成是一种对等的网络模型。P2P其实是实现网络上不同计算机之间，不经过中继设备直接交换数据或服务的一种技术。P2P由于允许网络中任一台计算机可以直接连接到网络中其他计算机，并与之进行数据交换，这样既消除了中间环节，也使得网络上的沟通变得更容易、更直接。

  - ppp

    ​       PPP(Point-to-Point、链路层协议)是为在同等单元之间传输数据包这样的简单链路设计的链路层协议。这种链路提供全双工操作

    ​		tcp就是点对点的，所以是全双工的

- ​    p2p优点：自扩展性强 占用带宽少 成本低 分发时间快

11.

- **电路交换（Circuit Switching**）：电路交换是一种建立专用通信路径的通信方式。在电路交换中，通信的源和目的地之间建立一个持续的、专用的物理连接，该连接在通信会话期间一直保持不变。在建立连接之后，通信路径上的资源（如带宽）被独占使用，无论是否有数据传输。典型的电路交换协议是电话网络中的传统电话通信。电路交换适合实时通信，对延迟和可靠性有较高要求，但资源利用率较低。
- **分组交换（Packet Switching）**：分组交换是一种将数据划分为小的数据包，并以独立的方式进行传输的通信方式。在分组交换中，数据被划分为固定大小的数据包（称为分组或数据报），每个分组带有目标地址和其他控制信息。这些分组通过网络独立传输，可能采用不同的路径和中间节点进行路由和转发。分组交换的典型协议是Internet中的IP（Internet Protocol）。分组交换具有较高的资源利用率，能够在网络中共享带宽，但在传输过程中可能会有延迟、丢包和重新排序等现象。

总体而言，电路交换适合于实时通信，对可靠性和延迟要求较高，但资源利用率较低。而分组交换适用于大规模数据通信，具有较高的资源利用率，但对延迟和可靠性要求相对较低。现代的计算机网络通常采用基于分组交换的协议，如IP网络，以满足大规模数据通信的需求。

12.网络层是为主机之间提供逻辑通信，而运输层为应用进程之间提供端到端的逻辑通信

13.常见端口号

| 协议/服务名称 | 端口号 | 简介                                                         |
| ------------- | ------ | ------------------------------------------------------------ |
| ftp           | 21     | File Transfer Protocol 文件传输协议，20用于连接，21用于传输  |
| ssh           | 22     | [Secure Shell](https://baike.baidu.com/item/Secure Shell) 安全外壳协议，专为[远程登录](https://baike.baidu.com/item/远程登录/1071998)会话和其他网络服务提供安全性的协议 |
| http          | 80     | Hyper Text Transfer Protocol 超文本传输协议，用于网页浏览    |
| DNS           | 53     | Domain Name System 域名系统，域名解析                        |
| https         | 443    | Hypertext Transfer Protocol Secure 超文本传输安全协议，用于安全浏览网页 |
| www代理服务   | 8080   | Apache Tomcat web server，进行网页浏览                       |
| smtp          | 25     | Simple Mail Transfer Protocol 简单邮件传输协议               |
| telnet        | 23     | 不安全的文本传送                                             |
| pop3          | 110    | Post Office Protocol                                         |

DHCP    67

14.

**网络边缘**：用户直接使用的主机组成，网络边缘是网络存在的理由。

**网络核心**：为网络边缘部分提供服务，由大量的网络及连接这些网络的路由器组成。

15. 主机的IP地址或者名字+目的端口号 才能唯一确定一个进程     bgp–tcp![image-20230605212628832](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605212628832.png)

对等层p2p采用协议进行通信

17.协议的基本要素：语法、语义、同步

网络协议是：通信双方必须遵守的报文格式

# 第二章 应用层

#### cookie

当用户第一次访问站点时，服务器将创建一个唯一的标识号，在其后端数据库中创建一个条目，并将此标识号作为cookie编号返回。此cookie编号存储在用户的主机上，并由浏览器管理。在每次后续访问（和购买）期间，浏览器将cookie编号发送回站点。因此，站点知道这个用户（更准确地说，是这个浏览器）访问该站点的时间。

2：邮件术语：邮件服务器

3: 套接字(API):应用层（进程）和运输层之间的接口，可以通过其控制应用层，但对运输层协议只能选择协议以及设置最大报文长度和缓存长度 

4：请求与响应必定成对，非持续连接中每个TCP连接只传输一个请求报文和一个响应报文。

5：HTTP持续连接一个TCP连接可传输一个web或者同一个服务器的多个web

6：UDP for DNS；TCP for HTTP

7：HTTP报文中的date：服务器查找并发送该响应报文的日期和时间

8：HTTP不能使用SMTP使用的方法，因为HTTP消息可以是二进制数据，而在SMTP中，消息主体必须是7位的ASCII格式。

#### **DNS（域名系统）**

- 运行在UDP上，端口53

- 作用：主机的DNS从URL中提取主机名，端DNS向服务器通过UDP查询主机名对应的IP，然后建立TCP（**解析域名**）

- 分类：根DNS 顶级域DNS（TLD）权威DNS **本地DNS**

- 查询：ISP给主机本地DNS ip地址，主机->本地DNS-根DNS-TLD DNS-权威DNS  主机只和本地交流（递归查询） 本地和其他三个交流（递归查询）也可以全是递归

- 缓存：本地DNS可缓存一段时间

- DNS资源记录

  RR（Name,Value,Type,[TTL]）

    （1）(主机名，IP，A)

  ​	 (2) （域，知道如何获得该域中主机IP地址的权威DNS服务器的主机名，NS）

    （3）（主机，规范主机名，CNAME）

    （4）（邮件服务器，规范主机名，MX）

#### FTP

- 运行在TCP上，20端口传输数据，21端口用于控制传输命令
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604234022923.png" alt="image-20230604234022923" style="zoom:50%;" />



#### **HTTP**

- web的协议 超文本传输协议
- url=主机名+具体对象的路径名
- 运行在TCP之上  无状态协议（不保存信息）
- 建议过程：客户发起TCP建立请求—–建立后通过TCP上的套接字访问TCP传输HTTP请求和接收HTTP响应报文（响应时间为 2RTT+传输HTML的时间）
- 分类：非持续连接 

  ​     	  持续连接（分为 带流水线【一次传10个都可以】和不带流水线）
- 报文格式

#### **电子邮件**

- ​	组成：用户代理 邮件服务器 SMTP

- SMTP 握手

  - [ ] ​	简单邮件传输协议 运行在TCP之上

  - [ ] 二进制多媒体—转换为7位ASCII码—还原到二进制多媒体数据

  - [ ] 过程:A–提供目的邮件地址给用户代理—-用户代理发给A的邮件服务器—-向B的邮件服务器建立TCP传输报文—B接受放入B的用户代理——B阅读

    ​	特点：直达、不经过中间服务器  

    ​				没发送成功后（B的邮件服务器没开机）留在A的服务器而不是B，在A进行多次发送尝试或者一段时间后删除

    ​				持续连接

    ​				HTTP拉协议 SMTP推协议

-   端邮件访问协议
  - IMAP
  - POP3
  - HTTP

​            

​           







# 第三章 运输层

1.![image-20230531095118610](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230531095118610.png)

2.TCP是面向字节的

3.udp校验和运算时，如果两个字节的同一个位置同时进行反转，那么结果是不会变的

4.mss加包头数据就等于mtu. 简单说拿TCP包做例子。 报文传输1400字节的数据的话，那么mss就是1400，再加上20字节IP包头，20字节tcp包头，那么mtu就是1400+20+20. 当然传输的时候其他的协议还要加些包头在前面，总之mtu就是总的最后发出去的报文大小。mss就是你需要发出去的数据大小

4.

```
TCP始终发送带有预期序列的ACK编号。
```

### 运输层知识体系梳理

#### 综述

- 对象 ：为不同主机上的应用进程提供逻辑通信
- 实现：在端系统中实现，将报文移动到网络边缘（网络层）
- 封装：运输岑报文段（传递给网络层后，网络层封装成数据包，网络层不检查已经在数据报中的运输层报文段）
- 特点：受限于底层网络层的服务模型
- 底线：最低限度提供一种复用分解服务

#### 多路复用和多路分解

- 过程：运输层–>进程拥有的套接字–>进程
- 多路复用：源主机从不同**套接字**收集数据块并且封装首部信息（用于分解）生成报文段，传递给网络层
- 多路分解：将运输层的报文段中的数据交付到正确的套接字的工作
- 对报文段的要求：对套接字有唯一标识符、包含源和目的端口号字段（0-65535 0-1023为周知端口号）
- UDP套接字（无连接）：二元组：目的IP和目的端口号（不同源ip的的相同目的IP和端口号将会传到一个地方去）
- TCP套接字（有连接）：四元组：源IP 源端口号 目的IP 目的端口号

#### UDP

- 特点：时间控制更加精细 无连接建议 无连接状态 首部开销小
- 用途：远程文件服务器、多媒体、因特网电话、网络管理、DNS域名解析
- 报文结构：<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604104901959.png" alt="image-20230604104901959" style="zoom: 33%;" />

​			（1）总共8字节的首部

- 校验和差错检测

  ​	<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604105353228.png" alt="image-20230604105353228" style="zoom: 50%;" />

#### 可靠数据传输协议  

包括流水线技术和停等技术

- ​	![image-20230604110911865](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604110911865.png)

#### 流水线可靠数据传输协议

- 优点：停等协议利用率太低

- 回退N步 GBN  接收方唯一维度的信息就是下一个预期要收到的分组序号

- 窗口最大2^k-1

  ​	![image-20230604111411265](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604111411265.png)

  - ​	选择重传 SR（selective repeat）

    ​      序列号空间必须至少是窗口大小的两倍，k≥2w。

    ​	<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604112334600.png" alt="image-20230604112334600" style="zoom: 67%;" />

GBN 窗口<=2^k^ -1 SR 窗口<=2^k-1^

 

**典型例题**

发送分组1 2 3 4 5，假设第二个丢失，直到最后全收到 **TCP始终发送带有预期序列的ACK编号**

![image-20230604233325359](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604233325359.png)

GBN浪费了大量的带宽，SR需要很大的数据链路层缓存空间

运行在TCP上的协议：HTTP FTP SMTP

运行在UDP上的协议：DNS DHCP

#### TCP

##### 特点：

- 面向连接 全双工服务 点对点（1对1 不存在1VN）

- 对比：• TCP具有GBN的特点 – 累积确认 – 一个重传定时器 • TCP具有SR的特点 – 只重传一个报文 – 缓存失序报文

- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604205748648.png" alt="image-20230604205748648" style="zoom:50%;" />

- MSS(最大报文长度) MTU（最大传输单元 链路层）Usually MTU为1460=1500(MTU)- 20(IP Header) -20 (TCP Header) TCP将大文件划分为长度为MSS的小块

- TCP 的服务器程序必须先于其客户程序运行。

  

  因为运行在TCP之上的客户机/服务器应用程序在**客户机运行后**，**它会尝试向服务器进程发起连接，而此时如果服务器进程没有运行，客户机进程就可能认为服务器不可达，从而返回错误信息；**

    对于UDP则没有这个要求，是因为运行在UDP之上的客户机/服务器应用程序在客户机进程运行之后不会向服务器进程发起连接，而是等待用户输入，因此客户程序可以先于服务器程序运行

  - 报文（首部20字节）：

  ​	<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604114337664.png" alt="image-20230604114337664" style="zoom: 50%;" />

  - 序号和确认号：

    <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604115049763.png" alt="image-20230604115049763" style="zoom:50%;" />

  - 确认号用于表达期望收到的下一个序号，累积确认 接收方总是返回期望的序号 • B先收到0-299，返回ACK=300 • 随后600-     899报文段，仍然返回ACK=300 	
  - ![image-20230604115648764](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604115648764.png)

​					本题说明A可能是上一个ACK，也说明不一定所有的分组都是20 B即正常情况 41明显不可能

​			##### 往返时间估计和超时

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604204228205.png" alt="image-20230604204228205" style="zoom:50%;" />

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604204210218.png" alt="image-20230604204210218" style="zoom:50%;" />

##### 流量控制

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604205406812.png" alt="image-20230604205406812" style="zoom:67%;" />

​				

```
LastByteRcvd-LastByteRead<=RcvBuffer
Rwnd=RcvBuffer-[LastByteRcvd-LastByteRead]
LastByteSent-LastByteAcked<=Rwnd
```

##### TCP连接管理

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604210044622.png" alt="image-20230604210044622" style="zoom:67%;" />

##### TCP**拥塞控制**AIMD

- 1.慢开始
  2.拥塞控制
  3.快恢复

- **当\**cwnd<ssthresh\**时，使用慢开始算法。**

  **当\**cwnd>ssthresh\**时，改用拥塞避免算法。**

  **当\**cwnd=ssthresh\**时，慢开始与拥塞避免算法任意。**

- ```text
  - 	超时：cwnd&->1 ssthresh->cwnd/2（取下限）
  
  -  三个ACK：cwnd&=（cwnd）/2+3   ssthresh->cwnd/2（取下限）
  ```

  

- 拥塞避免：线性增长，每秒一个MSS（y轴单位长度）

- 慢开始：指数级增长，2的指数

- 快速重传：收到三个冗余ACK后立刻发出这个ACK对应的分组

- 快速恢复：与上相同，主要在拥塞控制领域

- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604210516768.png" alt="image-20230604210516768" style="zoom:67%;" />



# 第四章 网络层：数据平面

1.数据平面的主要功能是转发数据包，转发数据报从它们的输入链路到它们的输出链路。例如，数据平面输入端口执行终止传入物理链路的物理层功能在路由器处，执行链路层功能以在另一个路由器上与链路层互操作传入链路的一侧，并在输入端口上执行查找功能。

控制平面的主要功能是路由，即确定数据包从源到目的地的路径。控制平面负责执行路由协议，响应连接的上下链路，与远程控制器通信，并执行管理功能。

2.输入端口、交换结构和输出端口在硬件中实现，因为它们的数据报处理功能对于软件实现来说太快了。传统路由器内部的路由处理器使用软件来执行路由协议，维护路由表和附加的链路状态信息，并计算路由器的转发表。此外，SDN路由器中的路由处理器还依赖于与远程控制器通信的软件，以便接收转发表条目并将它们安装在路由器的输入端口中。

数据平面通常由于需要快速而在硬件中实现例如以纳秒时标处理。控制平面通常在软件并以毫秒或秒时间工作,例如用于执行路由协议、响应向上或向下的附加链路,与远程控制器通信，并执行管理功能。

3.![image-20230531213019503](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230531213019503.png)

4.IPv6不进行分片操作，而是要求源端根据路径MTU发现和链路层的MTU进行适当的分段。(所以题目中分片的都是ipv4，首部字节为20)

### 网络层：数据平面知识梳理

#### 综述

- 数据平面：从输入链路接口向输出链路输出数据包 控制平面：协调这些本地路由器的转发动作（SDN）
- 转发是在数据平面实现的唯一功能，硬件实现
- 每台路由器中关键元素是它的转发表
- 服务模型 （因特网）：尽力而为模型

#### 路由器工作原理

- ​	结构

  ​			输入端口:接收分组，查找路由表 

  ​			交换结构：将路由器的输入端口与输出端口相连

  ​			输出端口：存储输入端口交换而来的分组，传输 到链路上

  ​			路由选择处理器：路由表生成和维护(传统路由 器) 

  ​			输入端口、输出端口和交换阵列往往用硬件实现，控制平面软件实现

  ​			转发方式：基于目的转发 and 通用转发（不学）

#### 输入端口处理和基于目的转发

- 最长前缀匹配原则

  ​		前缀越长，网络就越小，定位越精确；前缀越短，网络就越大

-  交换结构

  ​		<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604154606013.png" alt="image-20230604154606013" style="zoom:50%;" />		

  - 经内存交换：速度受内存带宽限制 (每个分组需要两次经过总线)所以速率<处理速率/2  **一次一个分组**
  - 经总线交换：总 线 竞 争 : 交 换 速 率 受 总 线 带 宽 限 制  **一次一个分组**
  - 经互联网络交换：可以多个分组同时发（不同的输入端口但通向同一个输出端口，就要等待）	

#### 输出端口处理		

- HOL(head of the line )阻塞：A和C都要向同一个输出端口发，如果A先发，C就要等待		
- 缓存B=RTT*c/N^0.5^	N为TCP流的数量 C链路容量	

#### 分组调度

- #### 先进先出：FIFO FCFS

- #### 优先队列： 低优先权发出的时候，高优先的分组不能打断

- #### 循环排队：1 2 1 2  1 2  保持工作排队：1没分组可发了，就发2

- #### 加权公平排队（WFQ）： 保持工作排队					

#### IPV4

- 报文（20字节）

  <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604163343262.png" alt="image-20230604163343262" style="zoom:67%;" />

- 切片，在端系统而不是路由器中组装
- 偏移以8字节为单位
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604170333836.png" alt="image-20230604170333836" style="zoom:50%;" />

##### 编址

- 接口：主机和物理链路之间的边界  路由器和任意一条链路之间的边界  路由器有多个接口 – 主机可以有多个接口
- 一个IP与一个接口相互关联

###### 分类

- CIDR 无类别域间路由选择 a.b.c.d/x x部分为子网或者网络（前缀）32-x为主机
- ABC类网络编址

- **IP地址**是一个32位的二进制数，通常被分割为4个“8位二进制数”（也就是4个字节）。IP地址通常用“点分十进制”表示成（a.b.c.d）的形式，其中，a,b,c,d都是0~255之间的十进制整数。

  ![image-20230603205203431](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230603205203431.png)

- ​	IP地址=网络地址+主机地址（注意ABC类的网络地址区段以及默认掩码）

- ![网络地址的划分](https://img-blog.csdn.net/20160712182446560)

- 主机标识段host 为全1 的IP 地址为广播地址，广播的分组传送给host ID段所涉及的所有计算机。例如，对于10.1.1.0 （255.255.255.0 ）网段，其广播地址为10.1.1.255 （255 即为2 进制的11111111 ），当发出一个目的地址为10.1.1.255 的分组（封包）时，它将被分发给该网段上的所有计算机。

- 主机地址全1是广播，全0是网络

- - # 根据IP地址和子网掩码求 网络地址 和 广播地址

    ------

    - 子网即网络
    - 将IP地址和子网掩码换算为二进制，子网掩码连续全1的是网络地址所占区间，后面的是主机地址
    - **IP地址和子网掩码进行与运算，结果是网络地址**（即主机号全0是网络地址）
    - 将运算结果中的网络地址不变，**主机地址变为1，结果就是广播地址**
    - 地址范围就是含在本网段内的所有主机

    - 主机的数量=2^主机地址所占比特-2

    减2是因为主机不包括网络地址和广播地址。

    **示例**
    一个主机的IP地址是202.112.14.137，掩码是255.255.255.224，要求计算这个主机所在网络的网络地址和广播地址

    ## 根据子网掩码可以分割网络号+主机号

    ------

    `255.255.255.224` 转二进制：

    > 11111111 11111111 11111111 11100000

    网络号有27位，主机号有5位

    网络地址就是：把IP地址转成二进制和子网掩码进行与运算

    11001010 01110000 00001110 10001001

    IP地址&子网掩码

    ```
    11001010 01110000 00001110 10001001
    
    11111111 11111111 11111111 11100000
    
    ------------------------------------------------------
    
    11001010 01110000 00001110 10000000
    ```

    即：202.112.14.128

    ## 计算广播地址

    ------

    广播地址：网络地址的主机位全部变成1 ，10011111 即159 即：202.112.14.159

    ## 主机数

    ------

    主机号有5位，那么这个地址中，就只能有个主机30-2

    因为其中全0作为网络地址，全1作为广播地址

    # 根据每个网络的主机数量进行子网地址的规划和计算子网掩码

    ------

    这也可按上述原则进行计算。

    比如一个子网有10台主机，那么对于这个子网需要的IP地址是
    10＋1＋1＋1＝13
    注意：加的第一个1是指这个网络连接时所需的网关地址，接着的两个1分别是指网络地址和广播地址。
    因为13小于16（16等于2的4次方），所以主机位为4位。

    而 256－16＝240 所以该子网掩码为255.255.255.240。

    如果一个子网有14台主机，不少人常犯的错误是：依然分配具有16个地址空间的子网，而忘记了给网关分配地址。这样就错误了，因为：
    14＋1＋1＋1＝17
    17.大于16，所以我们只能分配具有32个地址（32等于2的5次方）空间的子网。这时子网掩码为：255.255.255.224

    # 206.110.1.0 /18 被划分成16个子网，每个子网掩码？

    ------

    （划分成16个子网，根据子网掩码/18就表示有18个1，就要从的IP地址的主机位借4位来用作网络位！）

    子网掩码是255.255.252.0

    每个子网可以容纳的主机数是1024台。

    下面我来给你详细解答：

    206.110.1.0 /18 由最后的那个/18，我们可以知道这个IP已经规定了它的网络位是18位，它默认的子网掩码就是11111111.11111111.11 | 000000.00000000(其中1代表网络位,0代表主机位)

    可以看出我们可以操作的位数就是后面的14个0，也就是说我们可以在地面划分出几位作为子网的网络位，进而来划分子网。要求是切分成16个子网，我们知道2的4次方刚好等于16，这就说明子网网络位的位数是4位，那14-4=10就是子网的主机位。所以上面我写的那串二进制就可以变成：11111111.11111111.111111 | 00.00000000(其中1代表网络位,0代表主机位)

#### DHCP

- 动态主机配置协议，用于获取主机地址
- 即插即用 零配置
-  四次握手
- CS协议
- 过程：发现（客户广播包含DHCP发现报文的IP数据报）提供（选哪个） 请求（选这个）ACK（ok）

#### 网络地址转换（NAT）

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604170441697.png" alt="image-20230604170441697" style="zoom: 50%;" />
![image-20230604190920435](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604190920435.png)

#### IPV6

- 动机：32-bit 地址空间即将用尽
- – 固定长度的 40 字节首部
- •分片/重组：不允许分片 • 校验和: 全部去掉，减少每一跳的处理时间
- IPv4 到 IPv6过渡：双栈 隧道
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604170724469.png" alt="image-20230604170724469" style="zoom:50%;" />

#### 计算题

![image-20230604171403090](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604171403090.png)![image-20230604171413028](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604171413028.png)

![image-20230604171431860](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604171431860.png)

![image-20230604171527363](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604171527363.png)

# 第五章 网络层：控制平面

1.子网是较大网络的一部分；子网不包含路由器；其边界由路由器和主机接口定义。前缀是CDIR地址的网络部分；它以a.b.c.d/x形式写成；前缀包括一个或多个子网。当路由器在BGP会话中通告前缀时，它在前缀中包含许多BGP属性。在BGP术语中，前缀及其属性是BGP路由(或简单地说是路由)。

2.列举 4 种不同的 ICMP 报文。 答：回显回答、目的网络不可达、目的主机不可达、目的端口不可达、源点抑制

3.由于在BGP、循环中从AS到目的地都提供了完整的路径信息检测是简单的-如果BGP对等体接收到包含自己的AS号的路由AS路径，然后使用该路由将导致环路

4.只要是路由器知道了自己 AS 以外的路由 情况就是通过 BGP 协议，只有自己 AS 内的路由情况才用 RIP 或 OSPF，在 AS 内部用 BGP 传 阅时使用 iBGP，在 AS 的各个发言人之间使用 BGP 传阅用 eBGP

5.OSPF基于IP，所以它是传输层协议；RIP基于UDP协议，BGP基于TCP协议，所以它们是应用层协议。”基于”即”运行于”

6.**从动态路由协议的应用范围分**：

- IGP-内部网关协议。（OSPF  RIP）
- EGP-外部网关协议。(BGP)

**从动态路由协议使用的算法分：**：

- 距离矢量路由算法:RIP
- 链路状态路由算法:OSPF

7.BGP运行在自治系统之间，传递的是各子网可达的信息

####  网络层：控制平面知识体系梳理

##### 路由选择算法

###### 集中式路由选择算法：LS链路状态算法

格式：维护N –D( * ) –P( * )[关键上一个节点]

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604212844458.png" alt="image-20230604212844458" style="zoom:50%;" />

搜索节点总数：n*(n+1)/2    时间复杂度 O(n^2^)

###### 分散式路由选择算法：DV距离向量算法

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604213615833.png" alt="image-20230604213615833" style="zoom:50%;" />

![image-20230604213708060](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604213708060.png)

##### IGP（AS【自治系统】）

###### RIP

- DV算法核心
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604214145545.png" alt="image-20230604214145545" style="zoom:50%;" />
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604214204683.png" alt="image-20230604214204683" style="zoom: 50%;" />
- 通告通过 UDP 报文(端口520)进行发送, 周期性重 复

###### OSPF

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604214434660.png" alt="image-20230604214434660" style="zoom:67%;" />

##### BGP（AS间）

- 分布式 异步
- TCP 179端口号
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604220617459.png" alt="image-20230604220617459" style="zoom:67%;" />

- ​		热土豆算法（贪心）：选择内部开销最小的送出去
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604221026725.png" alt="image-20230604221026725" style="zoom:50%;" />
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604221052589.png" alt="image-20230604221052589" style="zoom:50%;" />

##### ICMP

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230604221447492.png" alt="image-20230604221447492" style="zoom:50%;" />



# 第六章 链路层和局域网

##### 

1.适配器和交换机之间的关系是，适配器是计算机或设备与局域网之间的物理接口，它通过连接到交换机的端口来实现与其他设备的通信

2.链路层协议能够向网络层提供哪些服务？在这些链路层服务中，哪些在 IP中有对应的服务？ 哪些在 TCP 中有对应的服务？ 答：封装成帧：IP 和 TCP 中也有封装 MTU 的功能；链路接入；可靠交付：TCP 中也有可靠交 付；流量控制：TCP 中也有流量控制；差错检测：IP 和 TCP 中也有差错检测；纠错；全双工： TCP 也是全双工。【答案一共写了七种功能，P287 只写了五种，流量控制和全双工通信没写， 其中 TCP 可以实现 4 种，IP 可以实现 2 种】

3.答：时隙 ALOHA：1, 2 和 4(时隙 ALOHA 仅部分分散，因为它需要所有节点中的时钟同步)。 令牌环网：1, 2, 3, 4。【P294 具体写了四条特性，这里简单概述：1.当仅有一个节点发送数据时， 该结点具有全部吞吐量；2.当有多个节点发送数据时，各节点均分吞吐量；3.协议是分散的，不 会因为某主节点故障而导致系统崩溃；4.协议是简单的，能够轻易实现】

4.248个MAC地址；232232个IPv4地址；21282128个IPv6地址。

#### 链路层和局域网知识梳理

1. 分类：点对点链路和广播信道

##### 位置

- 网络适配器（网络接口卡）=控制器（核心）+物理传输
- 大部分在硬件，小部分在CPU实现【高层链路功能】

##### 差错检测

##### 奇偶校验

- 一维 二位
- 接收方检测和纠正错误 的能力：前向纠错FEC

##### 检验和

##### CRC（循环冗余检测）

- d位bit数据D 余数R

- **多项式模2运行：**实际上是按位异或(Exclusive OR)运算，即相同为0，相异为1，也是不考虑进位、借位的二进制加减运算。如：10011011 + 11001010 = 01010001。

- **G生成多项式**：最高位为1；r+1位bit

- 冗余添加：计算时将D后面添加r位0

- 例：

  现假设选择的CRC生成多项式为G（X） = X4 + X3 + 1，要求出二进制序列10110011的CRC校验码？

  （1）G= 首先把生成多项式转换成二进制数，由G（X） = X4 + X3 + 1可以知道（，它一共是5位（总位数等于最高位的幂次加1，即4+1=5），然后根据多项式各项的含义（多项式只列出二进制值为1的位，也就是这个二进制的第4位、第3位、第0位的二进制均为1，其它位均为0）很快就可得到它的二进制比特串为11001。 【有时候G会直接给出】

  （2）       因为生成多项式的位数为5，根据前面的介绍，得知CRC校验码的位数为4（校验码的位数比生成多项式的位数少1）。因为原数据帧10110011，在它后面再加4个0，得到101100110000，然后把这个数以“模2除法”方式除以生成多项式，得到的余数（即CRC码）为0100，如下所示。

  ![img](https://img-blog.csdn.net/20170514161759680?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2F5aGVsbG9fd29ybGQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)

  （3）       把上步计算得到的CRC校验0100（R）替换原始帧101100110000后面的四个“0”，得到新帧101100110100。再把这个新帧发送到接收端。

  （4）       当以上新帧到达接收端后，接收端会把这个新帧再用上面选定的除数11001以“模2除法”方式去除，验证余数是否为0，如果为0，则证明该帧数据在传输过程中没有出现差错，否则出现了差错

  R=remainder (D*2^r^/G)

#### 多路访问链路协议（MAC **multiple access control protocol**）

- 点对点链路协议：PPP HDLC
-  广播(有线或无线共享) ：传统以太网   802.11无线局域网
- DOCSIS

##### 信道划分协议

- TDM
- FDM
- CDMA 码分多址

##### 随机接入协议

###### 时隙ALOHA 

- P=1/N取得最大值

![image-20230605194412317](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605194412317.png)

###### ALOHA

- p=1/(2N-1)

![image-20230605194706115](C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605194706115.png)

###### CSMA 载波侦听多路访问 

- 由于信道传播时延还会引起冲突
- 载波侦听：有线网络容易实现，无线网络困难
- CSMA/CD用于以太网,CSMA/CA用于无线网络

###### CSMA/CD 具有**碰撞检测**的载波侦听多路访问

- 于10 Mbps	比特时间 为0.1微秒	

- 拥塞信号：48比特，确保 所有传送者知道冲突发 生

- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605195346137.png" alt="image-20230605195346137" style="zoom:67%;" />
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605195740178.png" alt="image-20230605195740178" style="zoom:50%;" />
- 总结：随机接入协议一个节点活跃具有R，但没实现多个节点活跃R/M 

##### 轮流协议

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605200220467.png" alt="image-20230605200220467" style="zoom:50%;" />

#### 交换局域网

- 交换机运行在链路岑，交换链路层帧，不交换网络层数据报

##### 链路寻址和ARP

#### MAC地址

- 并不是主机或者路由器具有链路层地址，而是适配器（网络接口）具有链路层地址
- 链路层交换机和主机路由器的接口不具有链路层地址，交换机是透明的
- LAN地址、物理地址、MAC地址 Ethernet地址 多种叫法
- 长度六字节 十六进制表示法 固定
- MAC地址相当于身份证 IP相当于收件地址
- 广播地址 = FF-FF-FF-FF-FF-FF

##### ARP地址解析协议

###### 子网内部

- 广播帧出，标准帧回
- 知道目的MAC —- 直接查找ARP表
- 不知道目的MAC，将源目的IP以及源MAC包装成ARP分组，适配器广播帧作为目的MAC传到子网，目的主机返回响应ARP表，路由器更新ARP表
- 链路层和网络层协议的结合

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605203135562.png" alt="image-20230605203135562" style="zoom:67%;" />

###### 子网外部

- ARP—路由器左MAC—转发表—路由器右MAC——ARP

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605204043709.png" alt="image-20230605204043709" style="zoom: 67%;" />

#### 以太网

- 星型拓扑结构
- 连接设备: 集线器hub或交换机switch

##### 以太网帧

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605205219149.png" alt="image-20230605205219149" style="zoom:50%;" />

- 前同步码，8个字节 p 前7个字节为 10101010，最后一个为 10101011
- 目的地址: MAC地址，6个字节 m 如果适配器收到的帧的目的地址与之匹配或者是一个广播地 址(ARP包)，就把帧传给网络层 m 否则，抛弃该帧
- <img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605205522323.png" alt="image-20230605205522323" style="zoom:50%;" />

- 使用了CSMA/CD
- 基于现代交换机的以太网是全双工、无碰撞的

#### 链路层交换机

-  本质上是多口网桥
- 交换机表 自学习 来自哪个接口以及源MAC  即插即用
- 来自同一个子网的将被过滤
- 交换机具有大量接口 p 主机可以直接连接到交换机 p 没有冲突; 全双工模式运行
- 可混合各种共享/专用, 10/100/1000 Mbps 接口
- 网桥和交换机可以划分冲突域，但是不能划分广播域

即插即用：DHCP ARP 交换机表

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605212434616.png" alt="image-20230605212434616" style="zoom:67%;" />

<img src="C:\Users\huang\AppData\Roaming\Typora\typora-user-images\image-20230605212547533.png" alt="image-20230605212547533" style="zoom: 67%;" />









