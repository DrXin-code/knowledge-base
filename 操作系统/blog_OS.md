# 	[操作系统]

```
1.并发 并行 多道特征（关键词固定 填空或者简答）
特征需要好好背。实时系统的软硬
文件系统分为？  操作系统的主要功能 进程的组成（pcb 栈什么 填空题） 信息安全不在考试范围内。以选择题出现了解即可。   最容易丢用户接口。 操作系统的基本特征重中之重 掌握圆盘里面的每一个概念 每一个概念可能会展开说。    谁最重要：并发性 1.4基本没咋考过

2.第二章四十分以及更多
同步最重要 死锁的避免预防接触不是一回事 住意选择题的混淆。  进程的pcb干什么的 原语和原子操作。7状态模型 哪些状态不可达和可达 为什么可达。图会画 箭头。  顺序性 封闭性这几个性质要掌握 填空题
理解进程的特征。进程=balabla+balala。段不可忽略 选择题要注意！！！   交换和覆盖这一对也考的多。  挂起和阻塞考选择题（/什么会导致balabala） pcb里面包含的东西三个 常出。   模式（用户和内核 选择 以下哪个会导致模式的切换  原语很重要！！！ 进程的切换考得很多（以下哪个操作引起进程的切换 比较好的时机 选择题）。fork也考过很多次 很重要 易错点for循环后面的分号的位置 作业和进程调度区别 填空 作业调度的三种方式 长程 中 短   注意索引表的大小不能忽略 内核功能了解 注意一下两个模式切换。进程控制四种的什么会引起。   注意何时会发生进程切换 选择题会考。 程序阅读会考到fork 编程一般不会出现   线程和进程的区别 调度周转时间等等的计算 各种公式的定义 带不带抢占很重要 题干没要求作图可以不做图 进程和死锁可能有的是银行家算法 信号量编程必出。 什么小屋改进程序阅读能否实现改进，ppt上是互斥礼让。   整型信号量的问题 and信号量进餐。  信号量实现同步和互斥20分 管程还要学 可能性很大考。重中之重生产者消费者问题！ 几个经典模型 死锁的检测避免解除不是一回事

3.分区分配算法填空选择。紧凑和重定位 伙伴了解 覆盖和交换很重要 四到六个计算题 本章的计算题主要在分页 多级页表考了很多年 选择题级数多应用题一般两级。容易忽略快表！拉开差距！ 置换策略也是重点 belady现象

4.三个io控制方式 具体流程考的在填空选择
各种词汇都可能考 拿高分 磁盘调度的算法


信号量的题提前申明寄存器
看清是不是虚拟！！！！！！！！！！！！！！
```



## 系统综述

```
五个功能
处理机管理
存储器管理
设备管理
文件管理
提供用户接口
```

```

```

**中断**

[1.1.5 中断的概念和作用、内部中断、外部中断、中断机制的基本原理_处理器中断-CSDN博客](https://blog.csdn.net/qq_26553393/article/details/122239406)

### 目标

```
如何提高内存利用率
1.减少内外碎片
2.交换
3.共享分配
```

- 便利性
- 有效性
- 扩展能力

<img src="https://s2.loli.net/2024/03/12/X98biVAcJxYCNa5.png" alt="image-20231216142319905" style="zoom:50%;" />

### 概念

操作系统是指控制管理整个计算机系统的硬件和软件资源的程序集合，并合理地组织调度计算机的工作和资源的分配；以提供给用户和其他软件方便的接口和环境；它是计算机系统中最基本的系统软件----OS是由处理器执行的**程序集合**

- 系统资源的管理者

​			将进程放入内存进行执行

- 向上层提供方便易用的服务

![image-20231108105940252](https://s2.loli.net/2024/03/12/4UCKLbXmas7pAtQ.png)

- 作为最接近硬件的层次

### 特征

#### 并发

**最重要，其他特征的前提**

- 并发：两个或者多个事件同一时间间隔内发生  宏观上同时发生，微观上交替发生  
- 并行：两个或多个事件在同一时刻同时发生

-------

- 程序：静态实体，无法并发
- 进程：动态实体，可以并发

------

- 单处理机系统：进程可并发执行，无法并行执行
- 多处理机系统：进程既可并发执行，又可并行执行

#### 共享

系统中的资源可供内存中多个并发的进程**共同**使用

并发和共享互为存在条件

类型

- 临界资源：在一段时间内，只允许一个进程访问
- 非临界资源：在一段时间内，允许多个进程访问

共享方式

- 互斥访问共享：对临界资源的访问，如打印机
- 同时访问共享：对非临界资源的访问，如磁盘

#### 虚拟

- 时分复用技术：虚拟处理器、虚拟设备（打印机：SPOOLING技术）
- 空分复用技术：虚拟磁盘、内存

#### 异步

AKA：不确定性质

异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停，以不可预知的速度向前推进，这就是进程的异步性。

通常而言，操作系统的**不确定性是指异步性**，**而非**程序执行结果的不确定性。

------------------------------------------------------------------------------------

### 易发展性

- 硬件升级和新型硬件的出现
- 新设备、服务的出现
- 错误修复、纠正

### 发展分类

```
吞吐量=总量/总时间
```

**关心的目标**

```
批处理：吞吐时间和周转时间
交互式：响应时间
实时：截止时间
```

**交互式和批处理**

```
批处理：脱机控制或者自动控制，用户使用操作系统提供的作业控制语言写 控制说明书，连程序和数据一起交给OS
交互式：联机控制方式。使用操作系统提供的 操作控制命令，逐条输入命令控制作业执行，适用终端用户，来自终端的作业交终端作业
```



#### 串行处理

问题：调度、启动准备时间、无操作系统、控制台运行、输入设备（卡片阅读）载入计算机、顺序访问

#### 简单批处理系统

​			监控程序、一次处理一道作业、运行模式：用户和内核；问题：CPU大量时间空闲 因为Io速度比CPU慢

​			**监控程序的功能**：

​					自动续接下一个作业

​					内存保护：保护监控程序所在的内存区域

​					定时器：防止作业独占系统

​					特权指令：监控程序的指令：IO

​					中断

​			

<img src="https://s2.loli.net/2024/03/12/ZPgnUu8lmJzyLV5.png" alt="image-20231108201657936" style="zoom: 25%;" />

#### 多道批处理系统

- 多个作业并发执行
- 作业调度程序负责调度
- 硬件支持：I/O中断、直接存储器访问（DMA）
- 特征：多道性、调度性、无序性、**无交互能力**
- 会在内存中产生碎片
- **目的-----**提高**资源的利用率**和**系统吞吐量**

<img src="https://s2.loli.net/2024/03/12/SfXCutP9VvEA2Qq.png" alt="image-20231216155326917" style="zoom:67%;" />

<img src="https://s2.loli.net/2024/03/12/xjQWhaRUKiAGsdc.png" alt="image-20231108201815134" style="zoom: 25%;" />

#### 分时操作系统

- 仍然采用**多道程序设计技术**

- 多用户各自独立、通过不同终端、同时共享处理器、各自不干扰

- 特征：多路性、独立性、**及时性**、**交互性**----引入终端命令解释程序接受用户的命令，解释命令并执行还需要系统调用功能

- 第一个分时OS：CTSS

  <img src="https://s2.loli.net/2024/03/12/8m4tsliWSD2xNba.png" alt="image-20231216144604801" style="zoom: 50%;" />

<img src="https://s2.loli.net/2024/03/12/6LxNciB7n2XbIdZ.png" alt="image-20231108201907011" style="zoom: 25%;" />

#### 实时操作系统

- 及时响应
- 分类：如下，大多系统是二者结合
- 实时系统的特征**：实时性**、可靠性、多路性、独立性、交互性（比分时差）

<img src="https://s2.loli.net/2024/03/12/pmEgh1t2MckUnqz.png" alt="image-20231108201946433" style="zoom:25%;" />

### 主要功能

#### 进程

- 一段可执行的程序
- 程序所需要的相关数据（变量、工作空间、缓冲区等）
- 程序的执行上下文（execution context）
  ➢ 也称进程状态（process state）
  ➢ 操作系统用来管理和控制进程所需的所有数据

#### 内存管理

内存管理的任务

- 进程隔离：每个进程空间独立、互不干扰
- 自动分配和管理：OS动态分配、对程序员透明
- 模块化程序设计
- 保护和访问控制
- 永久存储

实现方式：文件管理+虚拟内存

文件管理

- 文件系统实现长期存储			
- 文件：有名称的对象，**保护和访问控制的基本单元**

虚拟内存

- 程序以逻辑方式访问存储器
- 多作业同时驻留内存
- – 每个作业部分驻留
- – 换入、换出机制

#### 信息保护安全

- 可用性
- 保密性
- 数据完整性
- 可靠性

#### 调度和资源管理

- 公平性
- 有差别的响应性
- 有效性：吞吐量和响应时间的折中

### 目标功能

- 处理机功能：进程、调度

- 存储器管理：

- 设备管理

- 文件管理

- 用户接口：

  - 命令接口：联机命令接口（实时）和脱机命令接口（批处理）
  - 程序接口（系统调用--（广义指令））

  <img src="C:/Users/LEGION/AppData/Roaming/Typora/typora-user-images/image-20231216152629454.png" alt="image-20231216152629454" style="zoom: 33%;" />

### 体系结构

- 无结构
- 模块化结构
- 分层式结构
  - 单向依赖关系：每层只能使用其直接下层所提供的服务 每层对其上层隐藏其下各层的存在
  - 缺点：效率低

- 微内核

​				<img src="https://s2.loli.net/2024/03/12/ONZyGh1d7ovHT4j.png" alt="image-20231216154351896" style="zoom:50%;" />

 				内核保留基本功能、C\S模式

### 

##  进程

```
高级通信机制归结为三大类
共享存储器系统
消息传递
管道通信
```



```
进程切换一定发生模式切换
模式切换不一定发生进程切换
```

![image-20231223232839668](https://s2.loli.net/2024/03/12/txkKzj8JwnV1y3T.png)

## 作业

**状态**

- 提交状态

- 后备状态：作业输入到OS缓冲池等待调度调入**内存**的状态

- 运行状态：在缓冲池中的作业由调度算法调入内存，**创建为进程，变为运行态**。

  ```
  PS:内存中进程的调度是微观调度，对于作业来说只要被调入内存创建进程后宏观上就是运行状态
  ```

- 完成状态：运行结束或者错误终止

```
进程性质：动态性（最基本特征）、并发性、独立性、异步性（同步的原因）
```

<img src="https://s2.loli.net/2024/03/12/wEvpi4zaGZRsV2U.png" alt="image-20231219200359213" style="zoom:50%;" />

### 顺序执行和并发执行

顺序

- 顺序性
- 封闭性：执行的程序独占资源，不会被打断
- 可再现性
- 表示：有向无循环图

并发

两个或者多个事件同一时间间隔内发生  宏观上同时发生，微观上交替发生

- 间断性
- 失去封闭性
- 不可再现性

<u>引入进程的目的是使多道程序能够正确地并发执行</u>

### 概念

- 一个正在**执行**的程序。
- 一个正在计算机上**执行**的程序实例。
- 一个能够被调度到处理器上**执行**的实体。
- 由一串指令的**执行**、当前状态和一组正在使用的系统资源表征的活动单元

---

- 程序：静态的、存放在磁盘里的可执行文件，就是一组有序指令集合；永久


- 进程：动态的，程序的一次执行过程，同一个程序多次执行会对应多个进程；具有生命周期

​		进程和程序不是一一对应----n:m

​		一个程序开始运行前,需要创建对应的进程,也就要创建相应的PCB

**对比**

- 动态性：进程具有动态性、生命周期；程序只是一组有序指令集合，静态实体。
- 并发性：进程可以并发；程序不可以
- 独立性：进程实体是一个能独立运行的基本单位，调度和资源分配的基本单位；未被建立进程的程序不能作为独立的单位参加运行

----

引入进程带来的开销：空间（数据结构）、时间、控制复杂性

### 组成

- PCB：进程控制块-----**由OS创建管理使用**  **常驻内存**  **进程存在的唯一标志** **OS根据PCB来对并发执行的进程进行控制管理**

  - 标示符:pid

  - 状态

  - 优先级

  - 程序计数器

  - 内存指针

  - 上下文数据

  - I/O状态信息

  - 记账信息

  ----

  **PCB的属性**可分为三类

  - **进程标识符**：PID、父id，Uid（创建进程的用户）
  - **处理机状态信息**：通用寄存器（用户可见寄存器）、控制和状态寄存器、栈
  - **进程控制信息**：优先级、数据结构、通信、特权、存储、资源使用权

  ----

- 程序段：程序的代码（指令序列）----多个子进程的代码可能一样（3个qq）

- 数据段：运行过程中产生的各种数据  


- 栈

### 特征

- 动态性：**最基本**、动态地产生变化消亡
- 并发性
- 独立性
- 异步性:各自独立的推进

### 状态

**五状态模型**

<img src="https://s2.loli.net/2024/03/12/c93dki5fz8rbCpD.png" alt="image-20231216170642918" style="zoom:50%;" />

- 创建态（新建态）：关于该进程的信息、进程标识符在内存的进程表中，也没有为与这个程序相关的数据分配空间，但进程还在外存
- 就绪态：当进程已分配到**除CPU以外**的所有必要资源后，只要再获得CPU，便可立即执行进程。
- 运行态：一个CPU只会有一个进程处于运行态，多核CPU才可以有多个进程处于运行态
- 阻塞态（等待态）：当进程已分配到除CPU以外的所有必要资源后，只要再获得CPU，便可立即执行进程。
- 终止态：表格和其它信息暂时保留
- <img src="https://s2.loli.net/2024/03/12/MpglxSRH7hiQVaE.png" alt="image-20231019211214892" style="zoom: 25%;" />

**交换技术**

​	内存中没有就绪进程或内存空间非常**紧张**时，系统将内存中**暂时不能运行**的进程，或暂时不用的数据和程序，Swapping-out**到外存**，以腾出足够的内存空间，把已具备运行条件的进程或进程所需要的数据和程序，Swapping-in**到内存**。

**挂起**

概念：将**内存中**处于阻塞、就绪、甚至是执行状态的进程放到外存，不再参与CPU的竞争

原因

- 交换
- OS主动挂起
- 进程全部阻塞，CPU空闲
- 调试
- 父进程请求

<u>**激活挂起**进程的进程就是**实施挂起**操作的进程</u>------解铃还须系铃人

**七状态模型**

<img src="https://s2.loli.net/2024/03/12/qbzdTmu93YktPBo.png" alt="image-20231216172553036" style="zoom:67%;" />



### 组织方式

- 链接方式：OS指针指向队列，多级队列和单一队列
- 索引方式：OS指针指向索引表

### 内核

**内核态**、系统态、特权态、管态

- 资源管理功能：进程管理、内存管理、IO管理
- 支撑功能：中断，记账、监视、时钟管理
- 可以执行指令系统的全集

**用户态**、常态、目态

双模式为了：**保护操作系统和重要的操作系统表（如PCB）不受程序干扰**

程序状态字PSR寄存器中存在指示执行模式的位

模式切换不一定会必然导致进程切换

### 控制

进程控制就是实现进程状态的转换、由原语来实现

----

**创建**

1. 触发事件

- 用户登录
- 作业调度：为被调度的作业分配进程
- 提供服务：打印机
- 已有进程请求：由现有进程派生

​	2.过程

- OS调用创建原语

- 分配唯一进程标识符
- 分配地址空间
- 初始化PCB
- 建立链接：插入就绪或者就绪挂起队列
- 建立或扩充其他数据结构

**create（）**

**终止**

1. 触发事件
   - 正常结束
   - 异常错误：越界错误 • 保护错误 • 非法指令 • 特权指令错 • 运行超时 • 等待超时 • 算术运算错、被0除 • I/O故障
   - 外界干预：Admin干预、父进程被终止、父进程终止

​	2.过程

- OS调用撤销7原语

- 根据PCB读取状态
- 终止执行，调度下一个就绪进程执行
- 终结子进程，向系统或父进程归还资源
- 从对应的队列中移除PCB

------

**阻塞**

1.触发事件

- 请求的系统服务得不到满足
- 访问临界资源
- 等待另一进程执行结果
- 无新工作可做

阻塞原语block**()**

**唤醒**

1.触发事件

- 阻塞事件发生

唤醒原语wakeup()

-----

**挂起**

suspend( )

**激活**

active()

---

**切换**

1.触发事件

- 时钟中断
- IO中断（不一定）
- 内存失效
- 陷阱：指令异常或错误
- 系统调用

2.过程

- 保存上下文 ，程序计数器和寄存器
- 更新当前执行的PCB，移动到新的队列
- 选择另外进程执行，更新PCB，移动队列
- 恢复上下文环境

```
执行态---就绪态：1.时间片用完 2.高优先级抢占
```



### fork()

### 通信

inter-process communication（IPC）

- 各进程拥有的内存地址空间相互独立

共享存储---最快的

- 两个进程在内存中申请一片共享存储区，映射到自己的地址空间
- 需要保证两个进程对共享空间的访问是**互斥**的（P、V）操作
- 基于存储区共享：高级通信，速度快，数据形式以及位置由进程控制
- 基于数据结构：低级
- 没有用到操作系统

消息传递

- 报文格式化传递（消息头+消息体）
- <img src="https://s2.loli.net/2024/03/12/1OTomUS6QXzIg3M.png" alt="image-20231022164725583" style="zoom:50%;" />
- 直接通信（标明ID）
- <img src="https://s2.loli.net/2024/03/12/mgdoqlfcej4HnhA.png" alt="image-20231022165246039" style="zoom:50%;" />
- 间接通信（通过信箱）

<img src="https://s2.loli.net/2024/03/12/cxD3CsAPUZuGMmp.png" alt="image-20231022165542680" style="zoom:50%;" />

管道通信

- 单向通信（半双工通信）
- pipe文件，实质是内存中开辟一个大小固定的内存缓冲区
- 管道中的信息先进先出，信息按队列式存储（区别与共享存储），循环队列
- 各进程的管道访问互斥（由OS实现）
- 管道满（空），写（读）进程阻塞
- 多个读会混乱->解决方案：1.（主）多个写一个读 2.多个写多个读，OS让各个读进程轮流读取（Linux）

## 线程

- 轻量级进程(LWP)

- 实现进程内部的并发
- 进程是资源分配的基本单位，线程是调度的基本单位，线程的切换开销较小
- 拥有少量私有资源
  ⚫ 线程控制块(含PC、寄存器、线程状态等信息)、栈等
- ![image-20231218203350114](https://s2.loli.net/2024/03/12/oeXDiFQ1tukOpAE.png)

相比进程的**优点**

- 进程可以并发不可以并行；进程可以并发也可以并行

- 创建、结束开销和时间
- 切换的速度块
- 相同的地址空间，通信快
- 有些进程的操作无需内核干预

<img src="https://s2.loli.net/2024/03/12/mHgf6AlGEynMTLD.png" alt="image-20231022203800542" style="zoom:50%;" />

### 状态

就绪、执行、阻塞

一般没有挂起态度

### 操作功能

- 派生：创建进程->线程、线程->线程
- 阻塞
- 解除阻塞
- 结束

### 实现方式

```
用户级线程：调度实体是线程映射到内核上的实体
内核级线程：每个线程都是处理机调度的实体
```

**用户级线程**

<img src="https://s2.loli.net/2024/03/12/wGqtZ5HmMIOEfbs.png" alt="image-20231022205908427" style="zoom:50%;" />

- 早期

- 由应用程序通过线程库实现，非OS

- 线程切换只需要在用户态下，无需切换核心态，系统开销小效率高

- OS不能看到用户级线程存在，OS眼中只有进程，OS看操作以进程为单位

- 缺点：**并发度不高 **  一个线程阻塞会造成整个进程阻塞，

- 即使多核CPU，一个进程对应一个CPU，线程无法并发

- 切换速度更快

- 线程数目增加，进程速度降低

- ```
  调度时，系统调度执行时间只用一个时间片
  ```

  

**内核级线程**

<img src="https://s2.loli.net/2024/03/12/sQSWhcrgfxYU4Iu.png" alt="image-20231022205931000" style="zoom:50%;" />

- 基于OS管理

- 线程的切换需要CPU变态

- 优点：并发性强，不会因为单个线程的阻塞影响进程

- 线程是CPU调度的基本单位，进程是分配资源的基本单位

- 缺点：一个进程占用多个内核线程，管理成本高，切换开销大

- 线程数目增加，进程速度增加

- 用户级线程即使多处理机也无法实现线程并行；内核级线程多处理机可以实现真正的线程并行

  ---

  补充

- TCB（线程控制块）

- <img src="https://s2.loli.net/2024/03/12/IqSnmHjeGtpDFZ9.png" alt="image-20231023111622798" style="zoom:50%;" />

## 